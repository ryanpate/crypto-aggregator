{{ define "main" }}
<div class="container mt-6">
    <style>
      .title {
        font-weight: bold;
      }
      .container {
        padding-left: 100px;
        padding-right: 100px;
      }
      /* Thumbnail styling */
      .crypto-item img {
        max-width: 200px;
        max-height: 200px;
        margin-right: 20px;
        float: left;
      }
      /* Clear floats on parent */
      .crypto-item::after {
        content: "";
        display: table;
        clear: both;
      }
      /* Title and summary container */
      .crypto-item-content {
        overflow: hidden;
      }
      .crypto-item-content a {
        font-size: 1.25rem;
        color: black;
        text-decoration: none;
        font-weight: bold;
      }
      /* Reduce section spacing */
      section.section {
        padding: 1rem 0;
        border-bottom: 1px solid #ddd;
      }
      /* Reduce list padding */
      ul {
        padding-left: 0;
        list-style: none;
      }
      /* Reduce margins on list items */
      li {
        margin-bottom: 1.5rem;
      }
    </style>
    <!-- <h1 class="title has-text-centered">Crypto News Aggregator</h1> -->

    {{ $all := .Site.Data.crypto }}
    {{ if not $all }}
    <div class="notification is-warning has-text-centered" style="margin-top: 1rem;">
        ⚠️ No data found in .Site.Data.crypto
    </div>
    {{ else }}
    {{ range $source, $articles := $all }}
    <section class="section">
        <h2 class="subtitle">{{ $source }}</h2>
        {{ if not (len $articles) }}
        <p><em>No articles for {{ $source }}</em></p>
        {{ end }}
        <ul>
            {{ range $articles }}
            <li>
                <div class="crypto-item">
                  {{ if .summary }}
                    {{/* Extract src from first <img> using replaceRE */}}
                    {{ $src := replaceRE `(?s).*<img[^>]*src="([^"]+)".*` `$1` .summary }}
                    {{ if ne $src .summary }}
                      <img src="{{ $src }}" alt="thumbnail" style="max-width:200px; max-height:200px; margin-right:20px; float:left;" />
                    {{ end }}
                  {{ end }}
                  <div class="crypto-item-content">
                    <a href="{{ .link }}" target="_blank">{{ .title }}</a>
                    {{ if .summary }}
                      {{/* Remove image tag from summary before printing text: */}}
                      {{ $clean := replaceRE `<img[^>]*>` "" .summary }}
                      <p class="is-size-7">{{ $clean | safeHTML }}</p>
                    {{ end }}
                  </div>
                </div>
            </li>
            {{ end }}
        </ul>
    </section>
    {{ end }}
    {{ end }}
    
</div>
{{ end }}